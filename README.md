# Web messengers handler OCR

Этот проект создан для детекции блоков сообщений и распознавания текста в них на скриншотах веб-мессенджеров. Когда вы отдаете фотографию в качестве входных данных, вы получаете ответ в формате JSON, который включает в себя: название канала, полученные и отправленные сообщения, имя отправителя сообщения, имя отправителя цитаты, саму цитату, если она есть в сообщениях, и время их отправки.


### Для правильной установки проекта необходимо выполнить нижеописааные шаги:

1. ```
   git clone git@github.com:Megvii-BaseDetection/YOLOX.git
   ```

2. ```
   cd YOLOX 
   ```

3. Удалить версии у трех последних библиотек в файле requirements.txt

4. ```
   pip3 install -v -e .
   ```
5. ```
   cd ..
   ``` 
6. ```
   pip install requirements.txt
   ```
7. Перед запуском решения на локальной машине под операционной системой Windows, необходимо скачать cmake и при установке добавить его в переменную PATH.  

## Запуск

### Для запуска решения на своих изображениях: 


1. ```
   cd src
   ```

2. ```
   python my_inf.py --path path_to_your_photo --conf 0.7 --nms 0.45 --messenger ___
   ```
   
## Описание Условий

Ключевые цели:

Создание решения, с использованиями нейронных сетей, по детекции и распознавания сообщений на скриншотах веб-мессенджеров.

В ходе исследования было разработано решение, которое при соблюдении нижеописаных условий выполняет задачу по детекции и распознавания сообщений и их записи в json файл вида:
```
{ channel name: Название чата или диалога,
   messages: [
   n: 
   {  owner: Имя отправителя сообщения
      quote_owner: Имя отправителя цитируемого сообщения
      quote: Цитируемое сообщение
      text: Текст сообщения
      time: Время отправления сообщения
      changed: Метка изменения сообщения
      type: Тип сообщения: входящие или исходящие
      }
   n+1: {...}
   ]
}
```
1. Мессенджер используемый в решении telegram или whatsapp.
2. На вход подается скриншот или папка со скриншотами открытого мессенджера, в одном из браузеров последних версий: Chrome, Firefox, Edge, на полный экран. 
3. На скриншоте мессенджера открыт диалог или чат, в обратном случае будет выведено что скриншот не содержит сообщений.
4. Поля owner, quote_owner, quote, если они содержаться в одном сообщении будут коректно заполненны, при условии, что все они видны на скриншоте.
5. Поля changed и time будут коректно заполнены, при условии, что они распозанны в последнем блоке.
6. Поле changed будет коректно заполнено, при условии, что его содержимое удовлетворяет регулярному выражению `^[a-zA-Zа-яА-Я]+$`.
7. Поле time будет коректно заполнено, при условии, что его содержимое удовлетворяет регулярному выражению `\d{1,2}[-.,;*:+ ]\d{1,2}|\d{1,2}\d{1,2}`.
8. Решение работает с русским и английским языком.
9. Решение может быть запущено в JupyterLab или на локальной машине с ОС Windows.


Возможные баги при использовании решения:

1. Запись полей owner, quote_owner, quote в неправильном порядке.
   
   Возможное решение:  Такое может возникать если сообщение неправильно обрезано или сообщение выходит за рамки чата/диалога.

2. Пустое поле text, при условии что text состоит только из символов или коротких слов.

   Возможное решение: Изменение easyocr модели.

3. Пропуск сообщений с скриншота по причине того что их confidence меньше чем confidence указаный при запуске.

   Возможное решение: Снижение параметра confidence при запуске решения или переобучение модели которая распознает сообщения на скриншотах.

4. Запись текста одного сообщения в текст следующего.

   Возможное решение: Переобучение модели для более лучшего результата, добавление/уменьшение пикселей к распознанному сообщению.

5. Не изменение поля changed на True, если оно не состоит в последнем распознанном блоке 

   Возможное решение: Проверка блока идущего перед последним на содержание слов 'edited | изменено'

6. Не изменение поля changed на True, если буквы l, t, i изменены распознающей текст моделью на 1 или 7.

   Возможное решение: Использовать другое регулярное выражение, если появляются цифры вместо букв.

7. Запись времени в поле text, если время не последний распознанный блок в сообщении.

   Возможное решение: Изменение easyocr модели.

8. Возможны проблемы с детекцией сообщений при использовании пользователем кастомных расширений связанных с изменением web-версий мессенджеров.

   Возможное решение: Отключение кастомных расширений перед использованием решения.
